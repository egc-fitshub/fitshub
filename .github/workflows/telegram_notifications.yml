name: Telegram Notify

on:
  workflow_run:
    workflows: ["*"]
    types: [completed]

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Send message to Telegram group
        run: |
          USER="${{ github.event.workflow_run.actor.login }}"
          BRANCH="${{ github.event.workflow_run.head_branch }}"
          STATUS="${{ github.event.workflow_run.conclusion }}"
          WORKFLOW="${{ github.event.workflow_run.name }}"
          RUN_URL="${{ github.event.workflow_run.html_url }}"

          if [ "$STATUS" = "success" ]; then
            ICON="‚úÖ"
          else
            ICON="‚ö†Ô∏è"
          fi

          MESSAGE="$ICON *$WORKFLOW*
          üë§ $USER
          üåø $BRANCH
          Resultado: *$STATUS*
          üîó [Ver ejecuci√≥n]($RUN_URL)"

          curl -s -X POST https://api.telegram.org/bot${{ secrets.TELEGRAM_TOKEN }}/sendMessage \
                    -d chat_id=${{ secrets.TELEGRAM_CHAT_ID }} \
                    -d text="$MESSAGE" \
                    -d parse_mode="Markdown"
