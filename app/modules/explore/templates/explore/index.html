{% extends "base_template.html" %}
{% set title = "Explore" %}

{% block breadcrumb %}

<ol class="breadcrumb text-muted fs-6 fw-semibold">
    <li class="breadcrumb-item"><a href="/" class="">Home</a></li>
    <li class="breadcrumb-item text-muted">Explore</li>
</ol>

{% endblock %}

{% block content %}
<div class="row g-4">

    <!-- Results -->
  <div class="col-lg-6">
    <div id="results-container"></div>

      <!--begin::Empty State-->
      <div id="no-results" class="text-center d-none mt-5" data-kt-search-element="empty">
          <div class="pt-10 pb-10">
              <i class="ki-duotone ki-search-list fs-4x opacity-50">
                  <span class="path1"></span>
                  <span class="path2"></span>
                  <span class="path3"></span>
              </i>
          </div>
          <div class="pb-15 fw-semibold">
              <h3 class="text-gray-600 fs-5 mb-2">No results found</h3>
              <div class="text-muted fs-7">Please try again with a different query</div>
          </div>
      </div>
      <!--end::Empty State-->
  </div>

  <!-- Filters -->
  <div class="col-md-6 col-lg-6 col-sm-12" id="filters-panel">
      <div class="card position-sticky" style="top: 85px; z-index: 1;">
          <div class="card-body">
              <!-- Filtro: búsqueda -->
               <div class="mb-3">
              <input id="search-query-filter" type="text" class="form-control" placeholder="Search datasets...">
              </div>
              <!-- Filtro: tipo de publicación -->
              <div class="mb-3">
                  <label class="form-label">Publication type</label>
                  <select class="form-select" id="filter-publication-type">
                    <option value="">Any</option>
                    <option value="annotationcollection">Annotation Collection</option>
                    <option value="book">Book</option>
                    <option value="section">Book Section</option>
                    <option value="conferencepaper">Conference Paper</option>
                    <option value="datamanagementplan">Data Management Plan</option>
                    <option value="article">Journal Article</option>
                    <option value="patent">Patent</option>
                    <option value="preprint">Preprint</option>
                    <option value="deliverable">Project Deliverable</option>
                    <option value="milestone">Project Milestone</option>
                    <option value="proposal">Proposal</option>
                    <option value="report">Report</option>
                    <option value="softwaredocumentation">Software Documentation</option>
                    <option value="taxonomictreatment">Taxonomic Treatment</option>
                    <option value="technicalnote">Technical Note</option>
                    <option value="thesis">Thesis</option>
                    <option value="workingpaper">Working Paper</option>
                    <option value="other">Other</option>
                </select>
              </div>

              <!-- Filtro: tags -->
              <div class="mb-3">
                <label class="form-label">Tags</label>
                <input id="filter-tags" 
                      type="text" 
                      class="form-control" 
                      placeholder="Enter tags separated by commas">
              </div>

              <!-- Filtro: fecha -->
              <div class="mb-3">
                <label class="form-label mb-0">Creation date</label>
                <div class="d-flex">
                  <div class="flex-fill">
                    <label class="form-text d-block">From</label>
                    <input id="filter-date-from" type="date" class="form-control" />
                  </div>
                  <div class="flex-fill">
                    <label class="form-text d-block">To</label>
                    <input id="filter-date-to" type="date" class="form-control" />
                  </div>
                </div>
                <div id="date-error" class="text-danger small mt-1 d-none">⚠️ End date must be after start date</div>
              </div>

              <!-- Filtro: comunidad -->
              <div class="mb-3">
                  <label class="form-label">Community</label>
                  <div class="custom-select-wrapper position-relative">
                      <div class="custom-select form-select" id="custom-community-select">
                          <span class="selected-option">Any</span>
                          <i class="ki-duotone ki-down fs-3 position-absolute" style="right: 12px; top: 50%; transform: translateY(-50%);"></i>
                      </div>
                      <div class="custom-options" id="community-options" style="display: none;">
                          <div class="custom-option" data-value="">
                              <span>Any</span>
                          </div>
                          {% for comm_id, comm_name, comm_logo_url in community_choices %}
                          <div class="custom-option" data-value="{{ comm_id }}" data-logo="{{ comm_logo_url }}">
                              {% if comm_logo_url %}
                              <img src="{{ comm_logo_url }}" alt="{{ comm_name }}" style="width: 24px; height: 24px; margin-right: 8px; border-radius: 4px; object-fit: cover;">
                              {% endif %}
                              <span>{{ comm_name }}</span>
                          </div>
                          {% endfor %}
                      </div>
                      <input type="hidden" id="filter-community" value="">
                  </div>
              </div>

              <!-- Filtro: orden -->
              <div class="mb-3">
                  <label class="form-label">Sort by</label>
                  <select class="form-select" id="filter-sorting">
                      <option value="newest">Newest first</option>
                      <option value="oldest">Oldest first</option>
                  </select>
              </div>

              <!-- Botón de limpiar -->
              <button class="btn btn-outline-primary w-100" id="clear-filters">Clear filters</button>
          </div>
      </div>
  </div>


</div>

{% endblock %}

{% block scripts %}
<script src="{{ url_for('explore.scripts') }}"></script>
<style>
.custom-select-wrapper {
    position: relative;
}

.custom-select {
    cursor: pointer;
    user-select: none;
    position: relative;
}

.custom-options {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: white;
    border: 1px solid #ced4da;
    border-radius: 0.25rem;
    max-height: 300px;
    overflow-y: auto;
    z-index: 1000;
    margin-top: 2px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.custom-option {
    padding: 8px 12px;
    cursor: pointer;
    display: flex;
    align-items: center;
    transition: background-color 0.2s;
}

.custom-option:hover {
    background-color: #f8f9fa;
}

.custom-option.selected {
    background-color: #e9ecef;
}

.selected-option {
    display: flex;
    align-items: center;
}

.selected-option img {
    margin-right: 8px;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const customSelect = document.getElementById('custom-community-select');
    const optionsContainer = document.getElementById('community-options');
    const hiddenInput = document.getElementById('filter-community');
    const selectedSpan = customSelect.querySelector('.selected-option');
    const options = optionsContainer.querySelectorAll('.custom-option');

    customSelect.addEventListener('click', function(e) {
        e.stopPropagation();
        optionsContainer.style.display = optionsContainer.style.display === 'none' ? 'block' : 'none';
    });

    options.forEach(option => {
        option.addEventListener('click', function(e) {
            e.stopPropagation();
            
            options.forEach(opt => opt.classList.remove('selected'));
            this.classList.add('selected');
            
            const value = this.dataset.value;
            hiddenInput.value = value;
            
            const logo = this.dataset.logo;
            const text = this.querySelector('span').textContent;
            
            if (logo && value) {
                selectedSpan.innerHTML = `<img src="${logo}" style="width: 24px; height: 24px; margin-right: 8px; border-radius: 4px; object-fit: cover;">${text}`;
            } else {
                selectedSpan.textContent = text;
            }
            
            optionsContainer.style.display = 'none';
            
            hiddenInput.dispatchEvent(new Event('change'));
        });
    });

    document.addEventListener('click', function() {
        optionsContainer.style.display = 'none';
    });

    optionsContainer.addEventListener('click', function(e) {
        e.stopPropagation();
    });
});
</script>
{% endblock %}